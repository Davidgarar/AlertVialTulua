<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mapa de Accidentes</title>
  <style>
    #map { height: 100vh; width: 100%; margin:0; padding:0; }
    body, html { height:100%; margin:0; }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- clave hardcodeada (funciona) -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGuzlSWeHrkxHu1PjR_DVRTjkNkQxd2gg&libraries=visualization"></script>

  <script>
    function initMap(dataPoints) {
      const center = { lat: 4.085, lng: -76.195 };
      const map = new google.maps.Map(document.getElementById('map'), { zoom: 13, center, mapTypeId: 'roadmap' });
      const heatData = dataPoints.map(p => new google.maps.LatLng(p[0], p[1]));
      const heatmap = new google.maps.visualization.HeatmapLayer({ data: heatData, radius: 30, opacity: 0.6 });
      heatmap.setMap(map);
    }

    fetch('/api/accidentes')
      .then(res => res.json())
      .then(data => initMap(data))
      .catch(err => { console.error(err); initMap([]); });
  </script>
</body>
</html>